<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Parking Details & Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.13.0/mapbox-gl.js"></script>
    <style>
        /* Flexbox layout to split the screen */
        body {
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            font-family: sans-serif;
        }

        /* Left panel for parking details */
        .left-panel {
            flex: 1;
            background-color: #f0f0f0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Right panel for the map */
        .right-panel {
            flex: 1;
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Rectangular map container */
        #map {
            width: 600px;
            height: 800px;
            border: 2px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="left-panel">
        <h2>Parking Details</h2>
        <!-- Future parking details content goes here -->
    </div>
    <div class="right-panel">
        <div id="map"></div>
    </div>
    <script>
        // Replace with your actual Mapbox access token
        mapboxgl.accessToken = 'pk.eyJ1IjoiYnJ5NG4iLCJhIjoiY204NWNpMWRoMmJuMzJrcWJ1N3N6c2J5OSJ9.zYlBwPLVBUBWvvlwZbfrmg';

        // Define the campus bounds for Stony Brook University
        const campusBounds = [
            [-73.147969, 40.891420], // Southwest corner [lng, lat]
            [-73.109477, 40.927109]  // Northeast corner [lng, lat]
        ];

        // Initialize the map without a preset center or zoom
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/light-v10',
            maxBounds: campusBounds // Prevents panning outside the campus
        });

        // Helper function to add a GeoJSON layer (with a label) to the map
        function addGeoJSONLayer(url, layerId, fillColor) {
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    // Add a "label" property to each feature if it doesn't already exist.
                    data.features.forEach(feature => {
                        if (!feature.properties.label) {
                            feature.properties.label = layerId;
                        }
                    });
                    // Add the GeoJSON source
                    map.addSource(layerId, {
                        type: 'geojson',
                        data: data
                    });
                    // Add a fill layer to display the parking section area
                    map.addLayer({
                        id: layerId + '-layer',
                        type: 'fill',
                        source: layerId,
                        paint: {
                            'fill-color': fillColor,
                            'fill-opacity': 0.5,
                            'fill-outline-color': '#000'
                        }
                    });
                    // Add a symbol layer to display the label based on the "label" property
                    map.addLayer({
                        id: layerId + '-labels',
                        type: 'symbol',
                        source: layerId,
                        layout: {
                            'text-field': ['get', 'label'],
                            'text-size': 14,
                            'text-offset': [0, 0],
                            'text-anchor': 'center'
                        },
                        paint: {
                            'text-color': '#000'
                        }
                    });
                })
                .catch(error => console.error('Error loading GeoJSON from ' + url, error));
        }

        // Array holding each GeoJSON file info; adjust file paths as needed
        const geojsonFiles = [
            { url: 'geojson/Lot 40.geojson', id: 'Lot 40', fillColor: '#088' },
            { url: 'geojson/Lot 53.geojson', id: 'Lot 53', fillColor: '#800' },
            { url: 'geojson/Lot 54.geojson', id: 'Lot 54', fillColor: '#800' },
            // Add more objects for additional files as required
        ];

        // Once the map loads, adjust the view and add each GeoJSON layer with labels
        map.on('load', function () {
            // Fit the map to the campus bounds
            map.fitBounds(campusBounds, { padding: 0 });
            // Loop through the array and add each GeoJSON layer along with its label layer
            geojsonFiles.forEach(file => {
                addGeoJSONLayer(file.url, file.id, file.fillColor);
            });
        });
    </script>
</body>

</html>